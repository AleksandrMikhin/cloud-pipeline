(self.webpackChunkHcsImageViewer=self.webpackChunkHcsImageViewer||[]).push([[822],{2221:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return st}});var n=r(7462),o=r(7294),i=r(3935),a=r(4942),c=r(9439),s=r(5697),u=r.n(s),l=r(4337),f=r(5671),d=r(3144),p=r(1752),v=r(136),h=r(4575),m=r(1120),b=r(5861),y=r(7757),g=r.n(y),O=r(4088),w=r(8918),j=r(3121);function P(e){var t=e[e.length-1];return 3===t||4===t}function Z(e){if(e&&e.shape){var t=P(e.shape),r=e.shape.slice(t?-3:-2),n=(0,c.Z)(r,2);return{height:n[0],width:n[1]}}}var S,k=function(e){(0,v.Z)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,m.Z)(t);if(r){var o=(0,m.Z)(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return(0,h.Z)(this,e)});function o(){return(0,f.Z)(this,o),n.apply(this,arguments)}return(0,d.Z)(o,[{key:"renderLayers",value:function(){for(var e=this.props,t=e.loader,r=e.id,n=e.mesh,o=void 0===n?{}:n,i=o.rows,a=void 0===i?0:i,c=o.columns,s=void 0===c?0:c,u=Z(t[0])||{},l=u.width,f=void 0===l?0:l,d=u.height,p=void 0===d?0:d,v=[],h=0;h<a;h+=1)for(var m=0;m<s;m+=1){var b=f/s,y=p/a,g=[m*b,h*y],w=[(m+1)*b,h*y],P=[(m+1)*b,(h+1)*y],S=[m*b,(h+1)*y];v.push([g,w,P,S])}return[new j.Z({id:"line-".concat(r),coordinateSystem:O.Df.CARTESIAN,data:[v],getPolygon:function(e){return e},getLineWidth:1,lineWidthUnits:"pixels",getLineColor:[220,220,220],filled:!1,stroked:!0})]}}]),o}(w.Z);k.layerName="CollageMeshLayer",k.defaultProps={loader:{type:"object",value:{getRaster:(S=(0,b.Z)(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{data:[],height:0,width:0});case 1:case"end":return e.stop()}}),e)}))),function(){return S.apply(this,arguments)}),getRasterSize:function(){return{height:0,width:0}},dtype:"<u2"},compare:!0},id:{type:"string",value:"collage-mesh-layer",compare:!0},pickable:{type:"boolean",value:!0,compare:!0},viewState:{type:"object",value:{zoom:0,target:[0,0,0]},compare:!0},mesh:{type:"object",value:{rows:0,columns:0},compare:!0}};var x=k;function D(e){return"-#".concat(e,"#")}function C(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function E(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?C(Object(r),!0).forEach((function(t){(0,a.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var L=function(e){(0,v.Z)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,m.Z)(t);if(r){var o=(0,m.Z)(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return(0,h.Z)(this,e)});function o(e){var t;(0,f.Z)(this,o),t=n.call(this,e);var r=e.mesh;return t.mesh=r,t}return(0,d.Z)(o,[{key:"getLayers",value:function(e){var t=e.viewStates,r=e.props,n=(0,p.Z)((0,m.Z)(o.prototype),"getLayers",this).call(this,{viewStates:t,props:r}),i=r.loader,a=this.id,c=this.height,s=this.width,u=t[a];return this.mesh&&n.push(new x(E(E({},r),{},{loader:i,id:"mesh-".concat(D(a)),mesh:E({},this.mesh),viewState:E(E({},u),{},{height:c,width:s})}))),n}}]),o}(l.O6);function R(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function z(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?R(Object(r),!0).forEach((function(t){(0,a.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):R(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var M=function(e){var t=e.loader,r=e.contrastLimits,n=e.colors,i=e.channelsVisible,a=e.viewStates,c=void 0===a?[]:a,s=e.colormap,u=e.overview,f=e.overviewOn,d=e.selections,p=e.hoverHooks,v=void 0===p?{handleValue:function(){},handleCoordinate:function(){}}:p,h=e.height,m=e.width,b=e.lensEnabled,y=void 0!==b&&b,g=e.lensSelection,O=void 0===g?0:g,w=e.lensRadius,j=void 0===w?100:w,P=e.lensBorderColor,Z=void 0===P?[255,255,255]:P,S=e.lensBorderRadius,k=void 0===S?.02:S,x=e.clickCenter,D=void 0===x||x,C=e.transparentColor,E=e.onViewStateChange,R=e.onHover,M=e.onViewportLoad,I=e.extensions,V=void 0===I?[]:I,A=e.deckProps,B=e.mesh,T=null==c?void 0:c.find((function(e){return e.id===l.ys})),N=(0,o.useMemo)((function(){return T||(0,l.TI)(t,{height:h,width:m},.5)}),[t,T]),H=new L({id:l.ys,height:h,width:m,mesh:B}),U={loader:t,contrastLimits:r,colors:n,channelsVisible:i,selections:d,onViewportLoad:M,colormap:s,lensEnabled:y,lensSelection:O,lensRadius:j,lensBorderColor:Z,lensBorderRadius:k,extensions:V,transparentColor:C},F=[],G=[],W=[];if(F.push(H),G.push(U),W.push(z(z({},N),{},{id:l.ys})),f&&t){var $=(null==c?void 0:c.find((function(e){return e.id===l.cl})))||z(z({},N),{},{id:l.cl}),_=new l.A6(z({id:l.cl,loader:t,detailHeight:h,detailWidth:m,clickCenter:D},u));F.push(_),G.push(z(z({},U),{},{lensEnabled:!1})),W.push($)}return t?o.createElement(l.iP,{layerProps:G,views:F,viewStates:W,hoverHooks:v,onViewStateChange:E,onHover:R,deckProps:A}):null},I="set-data",V="set-source-initializing",A="set-source",B="set-source-error",T="set-image",N="set-image-viewport-loaded";function H(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function U(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?H(Object(r),!0).forEach((function(t){(0,a.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):H(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function F(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function G(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?F(Object(r),!0).forEach((function(t){(0,a.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):F(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function W(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function $(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?W(Object(r),!0).forEach((function(t){(0,a.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):W(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var _=function(e,t){switch(t.type){case I:return function(e,t){var r=t.url,n=t.offsetsUrl,o=t.callback,i=e.url,a=e.offsetsUrl;return i===r&&n===a?(o&&o(),e):U(U({},e),{},{loader:void 0,metadata:void 0,imageIndex:0,imageTimePosition:0,imageZPosition:0,mesh:void 0,source:void 0,sourcePending:!1,sourceError:!1,sourceCallback:o,error:void 0,url:r,offsetsUrl:n})}(e,t);case"set-error":return function(e,t){var r=t.error;return G(G({},e),{},{error:r})}(e,t);case V:return function(e){return $($({},e),{},{loader:void 0,metadata:void 0,imageIndex:0,source:void 0,sourceError:void 0,sourcePending:!0,imagePending:!1})}(e);case B:return function(e,t){var r=t.error,n=e.sourceCallback;return"function"==typeof n&&setTimeout((function(){n({error:r})}),0),$($({},e),{},{loader:void 0,metadata:void 0,imageIndex:0,source:void 0,sourceError:r,sourcePending:!1,sourceCallback:void 0})}(e,t);case A:return function(e,t){var r=t.source,n=e.sourceCallback;"function"==typeof n&&setTimeout((function(){n()}),0);var o=Array.isArray(r)?r:[r],i=o.map((function(e){return e.data})),a=o.map((function(e){return e.metadata}));return $($({},e),{},{loader:i,metadata:a,imageIndex:0,source:r,sourceError:void 0,sourcePending:!1,sourceCallback:void 0})}(e,t);case T:return function(e,t){var r,n=t.index,o=t.ID,i=t.Name,a=t.search,s=t.imageTimePosition,u=void 0===s?0:s,l=t.imageZPosition,f=void 0===l?0:l,d=t.mesh,p=e.metadata,v=void 0===p?[]:p;if(null!=n)r=v[n];else if(void 0!==o)r=v.find((function(e){return e.ID===o}));else if(void 0!==i)r=v.find((function(e){return(e.Name||e.name||"").toLowerCase()===i.toLowerCase()}));else if(a&&/^[\d]+_[\d]+$/.test(a)){var h=/^([\d]+)_([\d])+$/.exec(a),m=(0,c.Z)(h,3),b=m[1],y=m[2],g=new RegExp("^\\s*well\\s+".concat(b,"\\s*,\\s*field\\s+").concat(y,"\\s*$"),"i");r=v.find((function(e){return g.test(e.Name||e.name)}))}if(r){var O=v.indexOf(r);return $($({},e),{},{imageIndex:O,imagePending:!0,imageTimePosition:u,imageZPosition:f,mesh:d})}return e}(e,t);case N:return function(e){return $($({},e),{},{imagePending:!1})}(e);case"set-mesh":return function(e,t){var r=t.mesh;return $($({},e),{},{mesh:r})}(e,t);default:return e}},q=r(2407),J=r(265);var K=function(e){(0,v.Z)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,m.Z)(t);if(r){var o=(0,m.Z)(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return(0,h.Z)(this,e)});function o(e){var t;return(0,f.Z)(this,o),t=e?n.call(this,"offsets.json file not found: ".concat(e)):n.call(this,"offsets.json file not specified"),(0,h.Z)(t)}return(0,d.Z)(o)}((0,q.Z)(Error));function Q(e,t,r){return X.apply(this,arguments)}function X(){return(X=(0,b.Z)(g().mark((function e(t,r,n){var o,i,a,c,s,u,l,f,d;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,J.W0)(t);case 2:return i=e.sent,e.next=5,i.getImage(0);case 5:if(a=e.sent,!Boolean(null==a||null===(o=a.fileDirectory)||void 0===o?void 0:o.SubIFDs)){e.next=9;break}return e.abrupt("return",r.reduce((function(e,t){var r=t.Pixels;return r.SizeC*r.SizeT*r.SizeZ+e}),1));case 9:return c=n[0].length,s=r[0].Pixels,u=s.SizeC,l=s.SizeT,f=s.SizeZ,d=u*l*f,e.abrupt("return",d*c);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Y(){return Y=(0,b.Z)(g().mark((function e(){var t,r,n,o,i,a,c,s=arguments;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.length>0&&void 0!==s[0]?s[0]:{},r=t.url,!(n=t.offsetsUrl)){e.next=8;break}return e.next=5,fetch(n);case 5:e.t0=e.sent,e.next=9;break;case 8:e.t0=void 0;case 9:if(o=e.t0,i=!o||!o.ok){e.next=17;break}return e.next=14,o.json();case 14:e.t1=e.sent,e.next=18;break;case 17:e.t1=void 0;case 18:return a=e.t1,e.next=21,(0,l.$L)(r,{offsets:a,images:"all"});case 21:if(c=e.sent,!i){e.next=28;break}return e.next=25,Q(r,c.map((function(e){return e.metadata})),c.map((function(e){return e.data})));case 25:if(!(e.sent>40)){e.next=28;break}throw new K(n);case 28:return e.abrupt("return",c);case 29:case"end":return e.stop()}}),e)}))),Y.apply(this,arguments)}var ee="set-default",te="set-loading",re="set-loaded",ne="set-error",oe="set-channel-properties",ie="set-color-map",ae="set-lens-channel",ce="set-lens-enabled",se="set-global-position",ue="set-lock-channels";function le(){var e=[];return{identifiers:[],channels:[],channelsVisibility:[],selections:e,builtForSelections:e,globalSelection:void 0,colors:[],domains:[],realDomains:[],contrastLimits:[],useLens:!1,useColorMap:!1,colorMap:"",lensEnabled:!1,lensChannel:0,use3D:!1,pixelValues:[],xSlice:[0,1],ySlice:[0,1],zSlice:[0,1],ready:!1,isRGB:!1,shapeIsInterleaved:!1,pending:!1,globalDimensions:[],metadata:void 0,loader:[],error:void 0,lockChannels:!1}}var fe=r(3433),de=r(4506);function pe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var ve=r(4925),he=["channels","colors","domains","contrastLimits"];function me(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function be(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?me(Object(r),!0).forEach((function(t){(0,a.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):me(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ye=[],ge=r(4477);function Oe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function we(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Oe(Object(r),!0).forEach((function(t){(0,a.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Oe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var je=[],Pe=[0,1];function Ze(e,t){switch(t.type){case te:return we(we({},e),{},{pending:!0,error:void 0});case re:return we(we({},e),{},{pending:!1});case oe:return function(e,t,r){var n=Object.entries(r||{}).filter((function(t){var r=(0,c.Z)(t,1)[0];return e&&e[r]&&Array.isArray(e[r])}));if(n.length>0){var o=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?pe(Object(r),!0).forEach((function(t){(0,a.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},e||{});return n.forEach((function(e){var r=(0,c.Z)(e,2),n=r[0],i=r[1],a=o[n];o[n]=(0,fe.Z)(a),o[n][t]=i})),o}return e}(e,t.channel,t.properties);case ie:var r=t.colorMap,n=void 0===r?"":r;return e.useColorMap?we(we({},e),{},{colorMap:n}):e;case ae:var o=t.lensChannel,i=void 0===o?0:o,s=e.lensEnabled,u=e.useLens;return s&&u?we(we({},e),{},{lensChannel:i}):e;case ce:var l=t.lensEnabled,f=void 0!==l&&l,d=e.lensEnabled,p=e.useLens;return we(we({},e),{},p&&!d&&f?{lensEnabled:f,lensChannel:0}:{lensEnabled:!1});case se:var v=t.position,h=void 0===v?{}:v,m=e.globalDimensions,b=void 0===m?[]:m,y=e.selections,g=void 0===y?[]:y,O=e.globalSelection,w=void 0===O?{}:O,j=function(e,t){var r=(b.find((function(t){return t.label===e}))||{}).size,n=void 0===r?0:r;return Math.max(0,Math.min(n,Math.round(t)))},P=Object.entries(h).filter((function(e){var t=(0,c.Z)(e,1)[0];return ge.Z.includes(t)&&b.find((function(e){return e.label===t}))})).map((function(e){var t=(0,c.Z)(e,2),r=t[0],n=t[1];return{dimension:r,position:j(r,n)}}));if(P.length>0){var Z=P.map((function(e){var t=e.dimension,r=e.position;return(0,a.Z)({},t,r)})).reduce((function(e,t){return we(we({},e),t)}),{}),S=we(we({},w),Z),k=g.map((function(e){return we(we({},e),Z)}));return we(we({},e),{},{selections:k,globalSelection:S})}return e;case ue:var x=t.lock,D=e.contrastLimits,C=void 0===D?je:D,E=e.realDomains,L=void 0===E?je:E,R=we(we({},e),{},{lockChannels:x});return x||(R.domains=L.slice(),R.contrastLimits=C.map((function(e,t){var r=L[t];if(r&&Array.isArray(r)&&2===r.length){var n=(0,de.Z)(e),o=n[0],i=n[1],a=n.slice(2),s=(0,c.Z)(r,2),u=s[0],l=s[1],f=function(e){return Math.max(u,Math.min(l,e))};return[f(o),f(i)].concat((0,fe.Z)(a))}return e}))),R;case ee:var z=function(e,t){var r=e||{},n=r.lockChannels,o=void 0!==n&&n,i=r.channels,a=void 0===i?ye:i,c=r.colors,s=void 0===c?ye:c,u=r.domains,l=void 0===u?ye:u,f=r.contrastLimits,d=void 0===f?ye:f,p=r.channelsVisibility,v=void 0===p?ye:p,h=t||{},m=h.channels,b=void 0===m?ye:m,y=h.colors,g=void 0===y?ye:y,O=h.domains,w=void 0===O?ye:O,j=h.contrastLimits,P=void 0===j?ye:j,Z=(0,ve.Z)(h,he);if(!o)return be(be({},Z),{},{channels:b,colors:g,domains:w,contrastLimits:P,realDomains:w.slice(),channelsVisibility:b.map((function(){return!0}))});for(var S=a.slice(),k=[],x=0;x<b.length;x+=1){var D=S.indexOf(b[x]);-1===D?k.push({channel:b[x],color:g[x],domain:w[x],realDomain:w[x].slice(),contrastLimits:P[x],visibility:!0}):(S.splice(D,1,void 0),k.push({channel:b[x],color:s[D]||g[x],domain:l[D]||w[x],realDomain:w[x].slice(),contrastLimits:d[D]||P[x],visibility:void 0===v[D]||v[D]}))}return be(be({},Z),{},{channels:k.map((function(e){return e.channel})),colors:k.map((function(e){return e.color})),domains:k.map((function(e){return e.domain})),realDomains:k.map((function(e){return e.realDomain})),contrastLimits:k.map((function(e){return e.contrastLimits})),channelsVisibility:k.map((function(e){return e.visibility}))})}(e,t),M=z.channels,I=void 0===M?je:M,V=z.channelsVisibility,A=void 0===V?je:V,B=z.selections,T=void 0===B?je:B,N=z.colors,H=void 0===N?je:N,U=z.domains,F=void 0===U?je:U,G=z.realDomains,W=void 0===G?F.slice():G,$=z.contrastLimits,_=void 0===$?je:$,q=z.useLens,J=void 0!==q&&q,K=z.useColorMap,Q=void 0!==K&&K,X=z.colorMap,Y=void 0===X?Q?e.colorMap:"":X,le=z.lensEnabled,me=void 0!==le&&le,Oe=z.lensChannel,Ze=void 0===Oe?0:Oe,Se=z.xSlice,ke=void 0===Se?Pe:Se,xe=z.ySlice,De=void 0===xe?Pe:xe,Ce=z.zSlice,Ee=void 0===Ce?Pe:Ce,Le=z.use3D,Re=void 0!==Le&&Le,ze=z.ready,Me=void 0!==ze&&ze,Ie=z.isRGB,Ve=void 0!==Ie&&Ie,Ae=z.shapeIsInterleaved,Be=void 0!==Ae&&Ae,Te=z.globalDimensions,Ne=void 0===Te?je:Te,He=z.metadata,Ue=z.loader;return we(we({},e),{},{identifiers:I.map((function(e,t){return"".concat(e||"channel","-").concat(t)})),channels:I,channelsVisibility:A,selections:T,builtForSelections:T,globalSelection:(T||[])[0],pixelValues:new Array((T||[]).length).fill("-----"),colors:H,domains:F,realDomains:W,contrastLimits:_,useLens:J,useColorMap:Q,colorMap:Y,lensEnabled:me,lensChannel:Ze,xSlice:ke,ySlice:De,zSlice:Ee,use3D:Re,ready:Me,isRGB:Ve,shapeIsInterleaved:Be,globalDimensions:Ne,error:void 0,metadata:He,loader:Ue});case ne:var Fe=t.error;return we(we({},e),{},{error:Fe,pending:!1});default:return e}}var Se=r(3467);function ke(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function xe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ke(Object(r),!0).forEach((function(t){(0,a.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ke(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function De(e,t){for(var r=[],n=xe(xe({},function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ge.Z;return e.labels.filter((function(e){return t.includes(e)})).map((function(e){return(0,a.Z)({},e,0)})).reduce((function(e,t){return xe(xe({},e),t)}),{})}(e)),t||{}),o=e.labels.map((function(t,r){return{name:t,size:e.shape[r]}})).find((function(e){return!ge.Z.includes(e.name)&&e.size})),i=0;i<Math.min(4,o.size);i+=1)r.push(xe((0,a.Z)({},o.name,i),n));return P(e.shape)?[xe(xe({},r[0]),{},{c:0})]:r}function Ce(e){return Ee.apply(this,arguments)}function Ee(){return(Ee=(0,b.Z)(g().mark((function e(t){var r,n,o,i,a,c,s;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.loader,n=t.selection,o=Array.isArray(r)?r[r.length-1]:r,e.next=4,o.getRaster({selection:n});case 4:return i=e.sent,a=(0,l.mx)(i.data),c=a.domain,s=a.contrastLimits,e.abrupt("return",{domain:c,contrastLimits:s});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Le(e){return Re.apply(this,arguments)}function Re(){return(Re=(0,b.Z)(g().mark((function e(t){var r,n,o,i,a,c,s,u,f,d,p,v;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.loader,n=t.selection,o=r[r.length-1],i=o.shape,a=o.labels,c=i[a.indexOf("z")]>>r.length-1,e.next=6,o.getRaster({selection:xe(xe({},n),{},{z:0})});case 6:return s=e.sent,e.next=9,o.getRaster({selection:xe(xe({},n),{},{z:Math.floor(c/2)})});case 9:return u=e.sent,e.next=12,o.getRaster({selection:xe(xe({},n),{},{z:Math.max(0,c-1)})});case 12:return f=e.sent,d=(0,l.mx)(s.data),p=(0,l.mx)(u.data),v=(0,l.mx)(f.data),e.abrupt("return",{domain:[Math.min(d.domain[0],p.domain[0],v.domain[0]),Math.max(d.domain[1],p.domain[1],v.domain[1])],contrastLimits:[Math.min(d.contrastLimits[0],p.contrastLimits[0],v.contrastLimits[0]),Math.max(d.contrastLimits[1],p.contrastLimits[1],v.contrastLimits[1])]});case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ze(e){return Me.apply(this,arguments)}function Me(){return(Me=(0,b.Z)(g().mark((function e(t){var r,n,o,i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.loader,n=t.selection,o=t.use3d,i=o?Le:Ce,e.abrupt("return",i({loader:r,selection:n}));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ie(e){return Ve.apply(this,arguments)}function Ve(){return(Ve=(0,b.Z)(g().mark((function e(t){var r,n,o,i,a,c;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.loader,n=t.selections,o=t.use3d,e.next=3,Promise.all(n.map((function(e){return ze({loader:r,selection:e,use3d:o})})));case 3:return i=e.sent,a=i.map((function(e){return e.domain})),c=i.map((function(e){return e.contrastLimits})),e.abrupt("return",{domains:a,contrastLimits:c});case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ae(e){var t=Array.isArray(e)?e[0]:e,r=t.shape,n=t.labels,o=function(e){var t,r,n=null!==(t=null==e||null===(r=e.meta)||void 0===r?void 0:r.physicalSizes)&&void 0!==t?t:{},o=n.x,i=n.y,a=n.z;if(null!=o&&o.size&&null!=i&&i.size&&null!=a&&a.size){var c=Math.min(a.size,o.size,i.size),s=[o.size/c,i.size/c,a.size/c];return(new Se.Z).scale(s)}return(new Se.Z).identity()}(t);return[[0,o[0]*r[n.indexOf("x")]],[0,o[5]*r[n.indexOf("y")]],[0,o[10]*r[n.indexOf("z")]]]}function Be(e){var t=e.Pixels||{},r=t.Channels,n=void 0===r?[]:r,o=t.SizeC,i=void 0===o?0:o,a=t.Interleaved,c=void 0!==a&&a,s=t.Type,u=n.length,l=(n[0]||{}).SamplesPerPixel;return 3===(void 0===l?0:l)||3===u&&"uint8"===s||3===i&&1===u&&c}var Te=[255,0,0],Ne=[0,255,0],He=[0,0,255],Ue=[255,255,255],Fe=[He,Ne,[255,0,255],[255,255,0],[255,60,0],[154,0,255],Ue,Te],Ge=[0,255];function We(e,t){return e.Name||e.name||e.ID||"Channel ".concat(t+1)}function $e(e,t,r,n){return _e.apply(this,arguments)}function _e(){return(_e=(0,b.Z)(g().mark((function e(t,r,n,o){var i,a,s,u,l,f,d,p,v,h,m,b,y,O,w,j,Z,S,k,x,D,C;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t[0]||{},a=i.shape,s=i.labels,u=(void 0===s?[]:s).map((function(e,t){return{label:e,size:a[t]||0}})).filter((function(e){return e.size>1&&ge.Z.includes(e.label)})),l=n||De(t[0],o),f=r.Pixels,d=(void 0===f?{}:f).Channels,p=void 0===d?[]:d,v=[],h=[],m=[],b=!1,y=!1,O=Be(r),w=O&&P(a),!O){e.next=18;break}P(a)?(v=[Ge.slice()],m=[Ge.slice()],h=[Te]):(v=[Ge.slice(),Ge.slice(),Ge.slice()],m=[Ge.slice(),Ge.slice(),Ge.slice()],h=[Te,Ne,He]),b=!1,y=!1,e.next=26;break;case 18:return e.next=20,Ie({loader:t,selections:l,use3d:!1});case 20:j=e.sent,m=j.domains.slice(),v=j.contrastLimits.slice(),h=1===j.domains.length?[Ue]:j.domains.map((function(e,t){return Fe[t]})),b=p.length>1,y=!0;case 26:return Z=p.map(We),S=Ae(t),k=(0,c.Z)(S,3),x=k[0],D=k[1],C=k[2],e.abrupt("return",{channels:Z,selections:l,useLens:b,useColorMap:y,colors:h,domains:m,contrastLimits:v,xSlice:x,ySlice:D,zSlice:C,ready:!0,isRGB:O,shapeIsInterleaved:w,globalDimensions:u,metadata:r,loader:t});case 29:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function qe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Je(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?qe(Object(r),!0).forEach((function(t){(0,a.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ke(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=n.selections,a=n.cache,c=n.imageTimePosition,s=void 0===c?0:c,u=n.imageZPosition,l=void 0===u?0:u,f=(0,o.useRef)(0);(0,o.useEffect)((function(){var n=e&&t&&e.Pixels&&t.length;if(n&&(i&&i!==a||!i)){r({type:te}),f.current+=1;var o=f.current;$e(t,e,i,s||l?{t:s,z:l}:void 0).then((function(e){o===f.current&&r(Je({type:ee},e))})).catch((function(e){console.warn("HCS Image Viewer error: ".concat(e.message)),console.error(e),r({type:ne,error:e.message})}))}else n||r({type:ee})}),[e,t,s,l,i,a,f,r])}function Qe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Xe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Qe(Object(r),!0).forEach((function(t){(0,a.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Qe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ye(){return{}}var et=function(){var e=(0,o.useReducer)(_,{},Ye),t=(0,c.Z)(e,2),r=t[0],n=t[1];!function(e,t){var r=e||{},n=r.url,i=r.offsetsUrl,a=r.source;(0,o.useEffect)((function(){n&&(t({type:V}),function(){return Y.apply(this,arguments)}({url:n,offsetsUrl:i}).then((function(e){return t({type:A,source:e})})).catch((function(e){return t({type:B,error:e.message})})))}),[n,i,t])}(r,n);var i=function(e){var t=(0,o.useReducer)(Ze,{},le),r=(0,c.Z)(t,2),n=r[0],i=r[1],a=function(e){var t=e.imageIndex,r=void 0===t?0:t,n=e.metadata,o=void 0===n?[]:n;if(!(r<0||r>=o.length))return o[r]}(e),s=function(e){var t=e.imageIndex,r=void 0===t?0:t,n=e.loader,o=void 0===n?[]:n;if(!(r<0||r>=o.length))return o[r]}(e),u=e.imageTimePosition,l=void 0===u?0:u,f=e.imageZPosition,d=void 0===f?0:f,p=n.metadata,v=n.loader,h=n.selections,m=n.builtForSelections;return Ke(a,s,i,(0,o.useMemo)((function(){return{imageTimePosition:l,imageZPosition:d}}),[l,d])),Ke(p,v,i,(0,o.useMemo)((function(){return{selections:h,cache:m}}),[h,m])),{state:n,dispatch:i}}(r),a=i.state,s=i.dispatch,u=(0,o.useCallback)((function(e,t,r){n({url:e,offsetsUrl:t,callback:r,type:I})}),[n]),l=(0,o.useCallback)((function(e){n(Xe({type:T},e))}),[n]),f=((0,o.useCallback)((function(e){n({type:T,mesh:e})}),[n]),(0,o.useCallback)((function(e){n(Xe({type:N},e)),s({type:re})}),[n,s])),d=(0,o.useCallback)((function(){s({type:te})}),[s]),p=(0,o.useCallback)((function(e,t){s({type:oe,channel:e,properties:t})}),[s]),v=(0,o.useCallback)((function(e){s({type:ie,colorMap:e})}),[s]),h=(0,o.useCallback)((function(e){s({type:ce,lensEnabled:e})}),[s]),m=(0,o.useCallback)((function(e){s({type:ae,lensChannel:e})}),[s]),b=(0,o.useCallback)((function(e){s({type:se,position:e})}),[s]),y=(0,o.useCallback)((function(e){s({type:ue,lock:e})}),[s]);return{callbacks:(0,o.useMemo)((function(){return{setData:u,setImage:l,setImageViewportLoading:d,setImageViewportLoaded:f,setChannelProperties:p,setColorMap:v,setLensEnabled:h,setLensChannel:m,setGlobalPosition:b,setLockChannels:y}}),[u,l,d,f,p,v,h,m,b,y]),dispatch:n,state:r,viewerState:a,viewerDispatch:s}};function tt(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=Array.isArray(e)?e[0]:e,o=Z(n);if(o&&t){var i=o.width,a=o.height;return Math.log2(Math.min(t.width/i,t.height/a))-r}return-1/0}function rt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function nt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?rt(Object(r),!0).forEach((function(t){(0,a.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ot=new l.$h,it=new l.z6;function at(e){var t=e.className,r=e.onStateChange,n=e.onRegisterStateActions,i=e.onViewerStateChanged,a=e.style,s=e.minZoomBackOff,u=void 0===s?0:s,f=e.maxZoomBackOff,d=void 0===f?void 0:f,p=e.defaultZoomBackOff,v=void 0===p?0:p,h=e.overview,m=et(),b=m.state,y=m.viewerState,g=m.callbacks,O=b.mesh,w=(0,o.useRef)(),j=function(e){var t=(0,o.useState)({width:void 0,height:void 0}),r=(0,c.Z)(t,2),n=r[0],i=r[1],a=(0,o.useRef)(void 0);return(0,o.useEffect)((function(){var t,r,n;return function o(){var c,s,u=null==e||null===(c=e.current)||void 0===c?void 0:c.clientWidth,l=null==e||null===(s=e.current)||void 0===s?void 0:s.clientHeight;e&&e.current&&(u!==t||l!==r)&&(i({width:t=u,height:r=l}),a.current={width:t,height:r}),n=requestAnimationFrame(o)}(),function(){return cancelAnimationFrame(n)}}),[e,i,a]),{size:n,sizeRef:a}}(w),P=j.sizeRef;(0,o.useEffect)((function(){r&&r(b)}),[b,r]),(0,o.useEffect)((function(){i&&i(y)}),[y,i]),(0,o.useEffect)((function(){n&&n(g)}),[g,n]);var Z=g||{},S=Z.setImageViewportLoading,k=Z.setImageViewportLoaded,x=y.channelsVisibility,D=void 0===x?[]:x,C=y.contrastLimits,E=void 0===C?[]:C,L=y.colors,R=void 0===L?[]:L,z=y.selections,I=void 0===z?[]:z,V=y.ready,A=void 0!==V&&V,B=y.colorMap,T=y.loader,N=y.useLens,H=y.lensEnabled,U=y.lensChannel;(0,o.useEffect)((function(){"function"==typeof S&&S()}),[I,T,S]);var F=(0,o.useState)(void 0),G=(0,c.Z)(F,2),W=G[0],$=G[1];(0,o.useEffect)((function(){if(T&&T.length&&P.current&&P.current.width&&P.current.height){var e=Array.isArray(T)?T:[T],t=(0,c.Z)(e,1)[0],r=Array.isArray(T)?T[T.length-1]:T,n=[nt(nt({},(0,l.TI)(T,P.current,v)),{},{id:l.ys,minZoom:void 0!==u?tt(t,P.current,u):-1/0,maxZoom:void 0!==d?tt(r,P.current,d):1/0})];$(n)}else $(void 0)}),[T,P,$,u,d,v]);var _=T&&A&&P.current&&P.current.width&&P.current.height&&W;return o.createElement("div",{className:t,style:nt({position:"relative"},a||{}),ref:w},_&&o.createElement(M,{mesh:O,contrastLimits:E,colors:R,channelsVisible:D,loader:T,selections:I,height:P.current.height,width:P.current.width,extensions:B?[ot]:[it],colormap:B||"viridis",onViewportLoad:k,viewStates:W,overviewOn:!!h,overview:h,lensSelection:N&&H?U:void 0,lensEnabled:N&&H,deckProps:{glOptions:{preserveDrawingBuffer:!0}}}))}at.propTypes={className:u().string,onStateChange:u().func,onRegisterStateActions:u().func,onViewerStateChanged:u().func,style:u().object,minZoomBackOff:u().number,maxZoomBackOff:u().number,defaultZoomBackOff:u().number,overview:u().object},at.defaultProps={className:void 0,onStateChange:void 0,onRegisterStateActions:void 0,onViewerStateChanged:void 0,style:void 0,minZoomBackOff:0,maxZoomBackOff:void 0,defaultZoomBackOff:0,overview:void 0};var ct=at;function st(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=r.onStateChange,c=r.onRegisterStateActions,s=r.onViewerStateChanged;i.render(o.createElement(ct,(0,n.Z)({onRegisterStateActions:c,onStateChange:a,onViewerStateChanged:s},t)),e)}},802:function(){},2195:function(){},1998:function(){},9521:function(){},9214:function(){},3752:function(){},3640:function(){},2630:function(){}}]);