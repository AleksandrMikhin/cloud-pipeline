# Check Groups Compute instances quota

Test verifies that
- billing quota for Compute instances specified for ***Groups*** is applied only on non-admin users

**Prerequisites**:
- Admin user 
- Non-admin user1 that is member of the has <`User_group`> role
- Non-admin user2 that is member of the <`User_group`> group and has <`User_role`> role
- Billing values:
    - *Compute instances* billing for the <`User_group`> for the current quarter is <`billing1`>
    - *Compute instances* billing for the <`User_role`> for the current month is <`billing2`>
- Perform [762_1](762_1.md) case

**Preparations**:
1. Login as non-admin1 user from the prerequisites
2. Open the **Tools** page 
3. Select test tool
4. Launch a selected tool with default settings
5. Repeat steps 2-4
6. At the **Runs** page, wait until **Pause** link appears for the just launched run 
7. Click **Pause** link and wait until **Pause** link is changed to **Resume**

| Steps | Actions | Expected results |
| :---: | --- | --- |
| 1 | Login as admin user from the prerequisites | |
| 2 | Open the **Billing** page | |
| 3 | Click **Quotas** tab |  |
| 4 | Select **Compute instances** tab in the **Quotas** section | | 
| 5 | Click **Add quota** button for ***Groups*** section | ***Create Compute instances quota*** modal opens that contains: <li> ***Group*** field <li> ***Quota*** field, <li> ***Quota period*** dropdown list with values `per month`, `per quarter`, `per year` (default value is `per month`) <li> ***Actions*** section that contains ***Threshold*** and ***Action*** fields and **Add Action** button <li> **Cancel** and **Save** buttons. |
| 6 | Click into the ***Group*** field and select <`User_group`> from the prerequisites | | 
| 7 | Input `<billing1>` value into the **Quota** field | |
| 8 | Set `per quarter` quota period | |
| 9 | Input `70` into the ***Threshold*** field | |
| 10 | Click ***Action*** field | Dropdown opens that contains: <li> *Notify* <li> *Disable new jobs* <li> *Stop all jobs* <li> *Block* | |
| 11 | Select ***Disable new jobs*** Action | |
| 12 | Click **Add Action** button | Additional row for pair of threshold-action appears |  
| 13 | Input `90` into the ***Threshold*** field | |
| 14 | Select ***Stop all jobs*** Actions | |
| 15 | Click **Save** button | The following info appears in the ***Groups*** section at the Quotas tab: <li> *Group* name <li> configured quota value <li> quota time period <li> configured pair of threshold-action |
| 16 | Repeat steps 5-12 with follows values: <li> *Group* - <`User_role`> <li> *Quota* - `<billing2>` <li> *Threshold* - 80 <li> ***Block*** Action
| 17 | Logout and login as non-admin user from the prerequisites | |
| 18 | Open the **Runs** page. Open **Competed runs** tab | |
| 19 | Check run launched at step 4 from the Preparations | Run has *Stopped* status |
| 20 | Click **Rerun** link for the run launched at step 4 from the Preparations | Error message `Launch of new compute instances is forbidden due to exceeded billing quota` appears | 
| 21 | Open **Active runs** tab and check run launched at step 5 from the Preparations | Run has *Paused* status |
| 22 | Click **Resume** link for run launched at step 5 from the Preparations | Error message `Launch of new compute instances is forbidden due to exceeded billing quota` appears |
| 23 | Open the **Tools** page | |
| 24 | Select test tool | |
| 25 | Launch a selected tool with default settings | Error message `Launch of new compute instances is forbidden due to exceeded billing quota` appears |
| 26 | Logout | |
| 27 | Try to login as non-admin user2 from the prerequisites | The page with the authorization error appears |

**After:**
- Remove quotas created at steps 15, 16 
