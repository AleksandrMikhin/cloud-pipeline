# Check Groups Storages quota

Test verifies that
- billing quota for Storages specified for ***Groups*** is applied only on non-admin users
- group billing quota for Storages can be specified for *Group*

**Prerequisites**:
- Admin user (has role `<User_role>` and is a member of the `<User_group>` group)
- Non-admin *user1* that has `<User_group>` group
- Non-admin *user2* that is member of the `<User_role>` role
- Billing values:
  - *Storages* billing for the `<User_group>` from the Prerequisites for the current quarter is `<billing1>`
  - *Storages* billing for the `<User_role>` from the Prerequisites for the current month is `<billing2>`
- Perform [762_1](762_1.md) case

**Preparations**:
1. Login as admin user from the prerequisites
2. Create 2 *object storages* (`storage1`, `storage2`) and *fs storage* (`fs_storage`). Give all permissions to these storages to non-admin user from the Prerequisites
3. Logout. Login as non-admin user1 from the prerequisites
4. Open the **Tools** page
5. Select test tool
6. Launch a selected tool with default settings

| Steps | Actions | Expected results |
| :---: | --- | --- |
| 1 | Login as admin user from the prerequisites | |
| 2 | Open the **Billing** page | |
| 3 | Click **Quotas** tab |  |
| 4 | Select **Storages** tab in the **Quotas** section | | 
| 5 | Click **Add quota** button for ***Groups*** section | ***Create storages quota*** modal opens that contains: <li> ***Group*** field <li> ***Quota*** field, <li> ***Quota period*** dropdown list with values `per month`, `per quarter`, `per year` (default value is `per month`) <li> ***Actions*** section that contains ***Threshold*** and ***Action*** fields and **Add Action** button <li> **Cancel** and **Save** buttons. |
| 6 | Click into the ***Group*** field and select `<User_group>` from the prerequisites | | 
| 7 | Input `<billing1>` value into the **Quota** field | |
| 8 | Set `per quarter` quota period | |
| 9 | Input `70` into the ***Threshold*** field | |
| 10 | Click ***Action*** field | Dropdown opens that contains: <li> *Notify* <li> *Read-only mode* <li> *Block* |
| 11 | Select ***Read-only mode*** Action |  |
| 12 | Click **Save** button | The following info appears in the ***Groups*** section at the Quotas tab: <li> *Group* name <li> configured quota value <li> quota time period <li> configured pair of threshold-action |
| 13 | Repeat steps 5-12 with follows values: <li> *Group* - `<User_role>` <li> *Quota* - `<billing2>` <li> *Threshold* - 80 <li> ***Block*** Action
| 14 | Open the **Library** page | |
| 15 | Open the `storage1` created at step 2 of Preparations | Storage page opens and is available for editing |
| 16 | Create `file1.txt` | | 
| 17 | Open the `fs_storage` created at step 2 of Preparations | Storage page opens and is available for editing |
| 18 | Logout | |
| 19 | Login as non-admin user from the prerequisites | |
| 20 | Repeat steps 14-17 | For both cases Storage page opens and doesn't contain <li> **Create** and **Upload** buttons for whole table <li> **Edit** and **Remove** buttons for each row |
| 21 | At the **Runs** page, click the run launched at step 11 of the Preparations
| 22 | Wait until the **SSH** hyperlink appears | |
| 23 | Click the **SSH** hyperlink | |
| 24 | Execute command: <br> `echo test >> /cloud-data/<storage2_name with path>/test_file1.txt`, <br>where `<storage2_name with path>` is the full path to the `storage2` created at step 7 of the Preparations |  <li>`test_file1.txt` file isn't created <li> Response `Read-only file system` is shown |
| 25 | Execute command: <br> `pipe storage cp cp://<storage1>/file1.txt cp://<storage2>/`, <br> where `<storage1>` and `<storage2>` are the storages created at step 7 of the Preparations |  <li>`file1.txt` file isn't copied <li> Response `Read-only file system` is shown |
| 26 | Execute command: <br> `echo test >> /cloud-data/<fs_storage>/test_file1.txt`, <br> where `<fs_storage>` is the full path to the `fs_storage` created at step 7 of the Preparations |  <li>`test_file1.txt` file isn't created <li> Response `Read-only file system` is shown |
| 27 | Logout
| 28 | Try to login as non-admin user2 from the prerequisites | The page with the authorization error appears |

**After:**
- Remove quotas created at steps 12, 13 
